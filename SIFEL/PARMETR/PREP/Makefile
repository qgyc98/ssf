################################################################
#
#  Makefile for preprocessor of parallel mechcode
#  
################################################################



# the following variable indicates the makefile as the parallel part of code
PARSIFEL = yes



################################################################### 
#  Include default part of Makefile - 
#  compiler definitions, flags, libraries ...
#
include ../../Makefile.in



################################################################### 
#  List of include directories
#
INCLUDES = ../../PARMETR/SRC:../../PARTRF/SRC:../../PARMEF/SRC:../../PARGEF/:../../METR/SRC:../../TRFEL/SRC/:../../MEFEL/SRC:../../MEFEL/PREP:../../GEFEL/:../../GEFEL/PARSER/:../../GEFEL/OPTIM:../../GEFEL/RANDY:../../GEFEL/CMLFILE:



################################################################### 
#  List of libraries
#

# list of local libraries
LOC_LIBS         = -lmet -lmef -lmprep -ltrf -lpmef -lptrf -lpargef -lgef



####################################################################
# List of source files
#
SRCS = pmetrprep.cpp



####################################################################
# List of object files
OBJS         := $(SRCS:%.cpp=$(OUTPUTPATH)%.o)
MOBJS        := $(OUTPUTPATH)pmetrprep.o
PMETRPREP    := $(OUTPUTPATH)pmetrprep
LIBPMETRPEP  := $(OUTPUTPATH)libpmetrprep.a
DEPS          := $(SRCS:%.cpp=$(OUTPUTPATH)%.d) $(MOBJS:%.o=%.d)



####################################################################
#  List of lib files
#

# list of dependent libraries
LIBDEPS  = $(SIFEL_ROOT)$(BIN_ROOT)GEFEL/$(OUTPUTDIR)libgef.a
LIBDEPS += $(SIFEL_ROOT)$(BIN_ROOT)TRFEL/SRC/$(OUTPUTDIR)libtrf.a
LIBDEPS += $(SIFEL_ROOT)$(BIN_ROOT)MEFEL/SRC/$(OUTPUTDIR)libmef.a
LIBDEPS += $(SIFEL_ROOT)$(BIN_ROOT)MEFEL/PREP/$(OUTPUTDIR)libmprep.a
LIBDEPS += $(SIFEL_ROOT)$(BIN_ROOT)TRFEL/PREP/$(OUTPUTDIR)libtprep.a
LIBDEPS += $(SIFEL_ROOT)$(BIN_ROOT)METR/SRC/$(OUTPUTDIR)libmet.a
LIBDEPS += $(SIFEL_ROOT)$(BIN_ROOT)PARGEF/$(OUTPUTDIR)libpargef.a
LIBDEPS += $(SIFEL_ROOT)$(BIN_ROOT)PARTRF/SRC/$(OUTPUTDIR)libptrf.a
LIBDEPS += $(SIFEL_ROOT)$(BIN_ROOT)PARMEF/SRC/$(OUTPUTDIR)libpmef.a
LIBDEPS += $(SIFEL_ROOT)$(BIN_ROOT)PARMETR/SRC/$(OUTPUTDIR)libpmetr.a

# list of paths for dependent libraries
DIR_LIBS  = -L$(SIFEL_ROOT)$(BIN_ROOT)GEFEL/$(OUTPUTDIR)
DIR_LIBS += -L$(SIFEL_ROOT)$(BIN_ROOT)TRFEL/SRC/$(OUTPUTDIR)
DIR_LIBS += -L$(SIFEL_ROOT)$(BIN_ROOT)MEFEL/SRC/$(OUTPUTDIR)
DIR_LIBS += -L$(SIFEL_ROOT)$(BIN_ROOT)MEFEL/PREP/$(OUTPUTDIR)
DIR_LIBS += -L$(SIFEL_ROOT)$(BIN_ROOT)TRFEL/PREP/$(OUTPUTDIR)
DIR_LIBS += -L$(SIFEL_ROOT)$(BIN_ROOT)METR/SRC/$(OUTPUTDIR)
DIR_LIBS += -L$(SIFEL_ROOT)$(BIN_ROOT)PARGEF/$(OUTPUTDIR)
DIR_LIBS += -L$(SIFEL_ROOT)$(BIN_ROOT)PARTRF/SRC/$(OUTPUTDIR)
DIR_LIBS += -L$(SIFEL_ROOT)$(BIN_ROOT)PARMEF/SRC/$(OUTPUTDIR)
DIR_LIBS += -L$(SIFEL_ROOT)$(BIN_ROOT)PARMETR/SRC/$(OUTPUTDIR)

#list of all necessary libraries
LIBS =  $(DIR_LIBS) $(LOC_LIBS) $(SYS_LIBS)



###########################################################################################
#  Following targets will be made regardless of whether there are files with the same names
#
.PHONY : parmetr pmechprep ptransprep



#########################################################################
#  Targets
#

all:  $(PMETRPREP)

$(PMETRPREP): $(LIBDEPS) $(MOBJS)
	@($(RM) $@)
	@($(RM) ../$@)
	@(echo "##### Creating pmetrprep executable . . .")
	$(PCC) -o $@ $(MOBJS) $(EXECFLAGS) $(LIBS)
	@(echo "##### pmetrprep was successfully created")

$(MOBJS): | $(OUTPUTPATH)
$(OBJS):  | $(OUTPUTPATH)

$(OUTPUTPATH):
	@(mkdir -p $(OUTPUTPATH))

$(LIBDEPS) : parmetr pmechprep ptransprep;

clean:    
	@($(RM)  $(PTRANSPREP) $(OBJS) $(DEPS) *~ core)
	@(echo " ptransprep was successfully cleaned")

cleanall: $(LIBDEPS)
	@($(RM) -r -f $(addprefix $(SIFEL_ROOT)$(BIN_ROOT)$(MODULE_PATH),$(REMOVEDIR)))
	@(echo " ptransprep was successfully cleaned")

cleandepall: $(LIBDEPS)
	@($(RM) -r -f $(SIFEL_ROOT)$(BIN_ROOT)$(MODULE_PATH))
	@(echo " ptransprep was successfully cleaned")



################################################################
# List of dependent targets
#
pmechprep: |parmetr
	+@(cd ../../PARMEF/PREP; $(MAKE) $(MAKECMDGOALS))

ptransprep: |pmechprep
	+@(cd ../../PARTRF/PREP; $(MAKE) $(MAKECMDGOALS))

parmetr:
	+@(cd ../../PARMETR/SRC; $(MAKE) $(MAKECMDGOALS))


####################################################################
#  Dependencies generated by compilers
#
-include $(DEPS)



####################################################################
#  Suffix rules
#
$(OUTPUTPATH)%.o : %.cpp
	@export CPATH=$(INCLUDES); \
	echo $(PCC) $(CFLAGS) -c $(<D)/$(<F); \
	$(PCC) $(CFLAGS) $(COMPATFLAGS) $(DEFS) -c $(<D)/$(<F) -o $(@D)/$(@F)
